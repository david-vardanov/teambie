<% layout('layouts/boilerplate') %>

<div class="page-header">
    <h1>Moderate Events</h1>
</div>

<p class="info-text">Review and approve or reject employee event requests.</p>

<% if (pendingEvents.length > 0) { %>
    <div class="moderation-list">
        <% pendingEvents.forEach(event => { %>
            <div class="moderation-item card">
                <div class="card-body">
                    <div class="moderation-header">
                        <h3><%= event.type.replace(/_/g, ' ') %></h3>
                        <span class="badge badge-<%= event.type.toLowerCase().replace(/_/g, '-') %>">Pending Review</span>
                    </div>

                    <div class="moderation-details">
                        <p><strong>Employee:</strong> <%= event.employee.name %></p>
                        <p><strong>Requested by:</strong> <%= event.createdBy ? event.createdBy.name : 'System' %></p>
                        <p><strong>Start Date:</strong> <%= event.startDate.toDateString() %></p>
                        <% if (event.endDate) { %>
                            <p><strong>End Date:</strong> <%= event.endDate.toDateString() %></p>
                            <%
                                const days = Math.ceil((new Date(event.endDate) - new Date(event.startDate)) / (1000 * 60 * 60 * 24)) + 1;
                            %>
                            <p><strong>Duration:</strong> <%= days %> day<%= days > 1 ? 's' : '' %></p>
                        <% } %>
                        <% if (event.notes) { %>
                            <p><strong>Notes:</strong> <%= event.notes %></p>
                        <% } %>
                        <p class="text-muted"><small>Requested: <%= event.createdAt.toLocaleString() %></small></p>
                    </div>

                    <div class="moderation-actions">
                        <form action="/events/moderate/<%= event.id %>/approve" method="POST" style="display: inline;">
                            <button type="submit" class="btn btn-primary">Approve</button>
                        </form>
                        <form action="/events/moderate/<%= event.id %>/reject" method="POST" style="display: inline;">
                            <button type="submit" class="btn btn-danger" onclick="return confirm('Reject this event request?')">Reject</button>
                        </form>
                    </div>
                </div>
            </div>
        <% }) %>
    </div>
<% } else { %>
    <div class="card">
        <div class="card-body">
            <p class="empty-state">No pending events to moderate</p>
        </div>
    </div>
<% } %>

<div class="form-actions" style="margin-top: 2rem;">
    <a href="/events/calendar" class="btn btn-secondary">Back to Calendar</a>
</div>
